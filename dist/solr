#!/bin/sh
# Starts and stops the solr jetty server.

#!/bin/bash

set_env(){
  export M2_HOME=/apps/apache-maven-3.2.5
  export JAVA_HOME=/apps/java
  export PATH=$PATH:$M2_HOME/bin:$JAVA_HOME/bin
}

case "$1" in
  start)
    echo === Starting Solr ===
    MVN=$(which mvn >& /dev/null)
    JAVA=$(which java >& /dev/null)

    if [[ -z $MVN ]] && [[ -z $JAVA ]]; then
      set_env;
    fi

    if [ !-z `pgrep -f jetty:run` ]; then
      (cd /apps/solr-env/jetty; nohup mvn -s /vagrant/dist/settings.xml -U jetty:run &);
      #mvn -s /vagrant/dist/settings.xml -U jetty:run
    else
      echo "Solr already running.";
    fi
    ;;

  stop)
    if [ ! -z `pgrep -f jetty:run` ]; then
      kill `pgrep -f jetty:run`;
      echo "Solr stopped."
    else
      echo "Solr not running";
    fi
    ;;

  restart)
    ./control stop
    sleep 2
    ./control start
    ;;

  *)
    echo invalid option
    ;;

esac
